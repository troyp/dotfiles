set runtimepath=~/.pentadactyl
set guioptions=bBCrMNsT
" js dactyl.plugins.buftabs.buftabs._options=true   
set hintkeys="jfkdls;ahgnvurieow"
set incfind
set hlfind
set findcase=smart
set showstatuslinks=status
set strictfocus=mail.google.com:laissez-faire,'chrome:*':laissez-faire,*:moderate
" Ex commands output in a new tab by default (prefs, addons...)
set newtab=all
" make yanks go to clipboard
js editor.defaultRegister="+"
set! browser.tabs.closeWindowWithLastTab=false

" PREFIX KEYS: s, ss, t, b, <C-c>
map -g user -b , @:

" Copying
map -g user -b <A-w> Y

" C-w closes tab; if last in window closes window.
map -g user -b <C-w> :q<CR>
map -g user -b J <C-d>
map -g user -b K <C-u>
map -g user -b <C-m><C-m> :emenu<SPACE>

" M-Up toggles the navigation and bookmarks toolbars
map -g user -b <A-Up> :set guioptions-=mTB | set showtabline=never<CR>
map -g user -b <A-Down> :set guioptions+=TB | set showtabline=always<CR>
map -g user -b <C-c><C-a> :set guioptions!=TB | set showtabline!=always,never<CR>
map -g user -b <C-c><C-m> :set guioptions!=m<CR>
map -g user -b <C-c><C-t> :set showtabline!=always,never<CR>
map -g user -b <C-c><C-n> :set guioptions!=T<CR>
map -g user -b <C-c><C-b> :set guioptions!=B<CR>
map -g user -b bb :set guioptions!=B<CR>
map -g user -b <C-c><C-s> :set guioptions!=B<CR>
map -g user -b <C-S-d> :dialog downloads<CR>
map -g user -b <C-c><C-f> :buftabs<CR>

" Restart with C-c C-r
map -g user -b <C-c><C-r> :restart<CR>

" Select
map -g user -b s <pass>
map -g user -b sk :bmarks!<SPACE>
map -g user -b s;k :bmarks<SPACE>
map -g user -b sh :history!<SPACE>
map -g user -b s;h :history<SPACE>
map -g user -b st :buffer<SPACE>
map -g user -b sj :jumps<CR>
map -g user -b sa :addons<CR>

" Manual sidebar selection with si, toggle with S
map -g user -b si :sidebar<SPACE>
" map -g user -b S :sidebar!<CR>
" Open/close AiOS, switch focus
map -g user -b S :js aios_toggleSidebar()<CR><f6><f6>
" Open AiOS, switch focus and enter passthrough
map -g user -b sS :js aios_toggleSidebar()<CR><f6><f6><C-z>

" Sidebar selection
map -g user -b sA :sidebar Add-ons<CR>
map -g user -b ssA :sidebar Add-ons<CR><f6><f6><C-z>
map -g user -b sM :sidebar Bookmarks<CR>
map -g user -b ssM :sidebar Bookmarks<CR><f6><f6><C-z>
map -g user -b sD :sidebar Downloads<CR>
map -g user -b ssD :sidebar Downloads<CR><f6><f6><C-z>
map -g user -b sH :sidebar History<CR>
map -g user -b ssH :sidebar History<CR><f6><f6><C-z>
map -g user -b sM :sidebar Moji<CR>
map -g user -b ssM :sidebar Moji<CR><f6><f6><C-z>
map -g user -b sO :sidebar HeadingsMap<CR>
map -g user -b ssO :sidebar HeadingsMap<CR><f6><f6><C-z>
map -g user -b sP :sidebar Preferences<CR>
map -g user -b ssP :sidebar Preferences<CR><f6><f6><C-z>


" Output newline in 'Pentadactyl Output <Date>' file
command! outputnewline :execute "!echo >> \"Pentadactyl Output " + Date().slice(0,15) + "\""
map -g user -b <C-c>0 :outputnewline<CR>

" ------
"  TABS
" ------
"
" Output list of tab hrefs
command! outputtabhrefs :tabdo :execute "!echo >> \"Pentadactyl Output " + Date().slice(0,15) + "\" " + content.location.href
map -g user -b t> :outputtabhrefs<CR>
" Output list of tab hrefs followed by a blank line
command! tabhrefs :normal t> <C-c>0
map -g user -b t. :tabhrefs<CR>
"
" Open in new tab
" t<SPACE> starts :tabopen (redundant since t is bound to tabopen by default,
" so an unknown key following t will trigger the builtin binding)
map -g user -b t<SPACE> :tabopen<SPACE>
" open DuckDuckGo search in new tab
map -g user -b ts :tabopen d<SPACE>
" open Google search in new tab
map -g user -b tg :tabopen g<SPACE>
" open Wikipedia search in new tab
map -g user -b tw :tabopen w<SPACE>
" open Wolfram Alpha search in new tab
map -g user -b ta :tabopen wa<SPACE>
" open W3C Wiki search in new tab
map -g user -b t3 :tabopen w3<SPACE>
" open New Tab Page
map -g user -b tn :tabopen about:newtab<CR>
" switch to first buffer matching argument (cycle through with gb, gB)
map -g user -b tt b
" switch to previously selected buffer
map -g user -b t- <C-^>
" toggle pinning of current tab
map -g user -b tp :pintab!<CR>
" duplicate current tab
map -g user -b td :tabduplicate<CR>
" close other tabs
map -g user -b t1 :tabonly<CR>
"
" Tab moving helpers
" map -g user -b -arg <C-m>t :tabmove <arg><CR>
map -g user -b tm :tabmove<SPACE>
map -g user -b <A-Left> :tabmove! -1<CR>
map -g user -b <A-Right> :tabmove! +1<CR>
map -g user -b <A-J> :tabnext<CR>
map -g user -b <A-K> :tabprevious<CR>
command! unpinall tabdo unpintab

" Command mode and insert mode
cmap -g user -b <C-Y> <C-V><C-V>
imap -g user -b <C-Y> <C-V><C-V>
command! rc source ~/.pentadactylrc
command! rce viewsource! file:/home/troy/.pentadactylrc

" Visual mode
" C-e end of line, C-a start of line.
" C-y scroll down, C-Y scroll up.
vmap -g user -b <C-a> 0
vmap -g user -b <C-e> $
vmap -g user -b <C-S-Y> <C-e>
" to search and select:
" ----------------------
" 1. press / and type search term
" 2. when satisfied, press enter
" 3. press C-/ to clear highlighting of other matches
" 4. press i to enter insert mode
" 5. press <left> to move to start of match
" 6. press v to enter visual mode
" 7. use visual mode keys j,k,h,l,C-a,C-e, etc to extend selection

" replace builtin <C-a> and <C-x> bindings with ]; and [; (inrease/decrease URL by 1)
nmap -g user -b ]; <C-a>
nmap -g user -b [; <C-x>

" Search
" clear the search term highlighting
map -g user -b <C-/> :noh<CR>
map -g user -b s/ /\r

" Add hints for anchor elements whose class attribute starts with "vote"
set hinttags+=a[class^='vote']
set hinttags+=a[class^='speed']

"hi Hint font-family: "Monospace"; line-height: 15px; text-shadow: 1px 1px 1px #000; padding: 5px 8px 6px; font-size: 13px; font-weight: normal; color: white; background-color: rgba(0, 0, 0, 0.75); -moz-border-radius: 1em; -moz-box-shadow: 0 0 4px rgba(0,0,0,1);
hi Hint font-family: "Monospace"; line-height: 14px; text-shadow: 1px 1px 1px #888; padding: 5px 8px 6px; font-size: 18px; font-weight: bold; text-transform: uppercase; color: rgb(200, 0, 0); background-color: rgba(240, 255, 240, 0.80); -moz-border-radius: 1em;
hi HintElem background-color: rgba(55, 255, 50, 0.15) !important; -moz-border-radius: 2px;
hi HintActive background-color: rgba(54, 255, 250, 0.2) !important; color: black !important; -moz-border-radius: 2px;

" EdX
command! edx :so ~/.pentadactyl/edx.pentadactyl
command! edxe viewsource! file:/home/troy/.pentadactyl/edx.pentadactyl
edx

" Coursera
set passkeys+='class.coursera.org/.*/lecture/':'hp-+fc<up><down><left><right>'

" Autopager
command! apoff :js autopagerMain.enabledThisSite()
command! ap :js autopagerMain.onEnable()

" Pages
command! ac :winopen about:config

" Print What You Like
command! prwul :o javascript:(function(){if(window['ppw']&&ppw['bookmarklet']){ppw.bookmarklet.toggle();}else{window._pwyl_home=%22http://www.printwhatyoulike.com/%22;_pwyl_bmkl=document.createElement('script');_pwyl_bmkl.setAttribute('type','text/javascript');_pwyl_bmkl.setAttribute('src',_pwyl_home+'static/compressed/pwyl_bookmarklet_10.js');_pwyl_bmkl.setAttribute('pwyl','true');document.getElementsByTagName('head')[0].appendChild(_pwyl_bmkl);}})();

